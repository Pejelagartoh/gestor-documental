<h2 mat-dialog-title>{{ isEditMode ? 'Editar' : 'Registro de' }} recepción de documentos</h2>
<mat-dialog-content>
  <form [formGroup]="form" class="form-grid">

    <!-- Tramo (OBLIGATORIO) -->
    <mat-form-field appearance="outline">
      <mat-label>Tramo *</mat-label>
      <mat-select formControlName="tramo">
        <mat-option *ngFor="let t of tramos" [value]="t">{{ t }}</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('tramo')?.hasError('required')">Este campo es obligatorio</mat-error>
    </mat-form-field>

    <!-- Tipo Documento (OBLIGATORIO) -->
    <mat-form-field appearance="outline">
      <mat-label>Tipo Documento *</mat-label>
      <mat-select formControlName="tipoDocumento">
        <mat-option *ngFor="let td of tiposDocumento" [value]="td">{{ td }}</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('tipoDocumento')?.hasError('required')">Este campo es obligatorio</mat-error>
    </mat-form-field>

    <!-- N° Documento (OBLIGATORIO) -->
    <mat-form-field appearance="outline">
      <mat-label>N° Documento *</mat-label>
      <input matInput formControlName="nroDocumento" />
      <mat-error *ngIf="form.get('nroDocumento')?.hasError('required')">Este campo es obligatorio</mat-error>
    </mat-form-field>

    <!-- Fecha Documento (OBLIGATORIO) -->
    <mat-form-field appearance="outline">
      <mat-label>Fecha Documento *</mat-label>
      <input matInput [matDatepicker]="fd" formControlName="fechaDocumento" />
      <mat-datepicker-toggle matSuffix [for]="fd"></mat-datepicker-toggle>
      <mat-datepicker #fd></mat-datepicker>
      <mat-error *ngIf="form.get('fechaDocumento')?.hasError('required')">Este campo es obligatorio</mat-error>
    </mat-form-field>

    <!-- Fecha Ingreso (OBLIGATORIO) -->
    <mat-form-field appearance="outline">
      <mat-label>Fecha Ingreso *</mat-label>
      <input matInput [matDatepicker]="fi" formControlName="fechaIngreso" />
      <mat-datepicker-toggle matSuffix [for]="fi"></mat-datepicker-toggle>
      <mat-datepicker #fi></mat-datepicker>
      <mat-error *ngIf="form.get('fechaIngreso')?.hasError('required')">Este campo es obligatorio</mat-error>
    </mat-form-field>

    <!-- Campos Opcionales -->
    <mat-form-field appearance="outline">
      <mat-label>Remitente</mat-label>
      <input matInput formControlName="remitente" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Cargo Remitente</mat-label>
      <input matInput formControlName="cargoRemitente" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Destinatario</mat-label>
      <input matInput formControlName="destinatario" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Cargo Destinatario</mat-label>
      <input matInput formControlName="cargoDestinatario" />
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Antecedentes Documento</mat-label>
      <textarea matInput formControlName="antecedentesDocumento" rows="2"></textarea>
    </mat-form-field>

    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Materia Documento</mat-label>
      <textarea matInput formControlName="materiaDocumento" rows="2"></textarea>
    </mat-form-field>

    <!-- Área Responsable (OBLIGATORIO) -->
    <mat-form-field appearance="outline">
      <mat-label>Área Responsable *</mat-label>
      <mat-select formControlName="areaResponsable">
        <mat-option *ngFor="let a of areas" [value]="a">{{ a }}</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('areaResponsable')?.hasError('required')">Este campo es obligatorio</mat-error>
    </mat-form-field>

    <!-- Checkbox Instruye Respuesta (Opcional, booleano) -->
    <div class="mat-form-field-wrapper mat-form-field-checkbox">
      <mat-checkbox formControlName="instruyeRespuesta" color="primary">
        Instruye Respuesta
      </mat-checkbox>
    </div>

    <!-- Sección 2: Datos de Respuesta (Opcional) -->
    <mat-form-field appearance="outline">
      <mat-label>Registro Salida</mat-label>
      <input matInput formControlName="registroSalida" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Tipo Respuesta</mat-label>
      <input matInput formControlName="tipoRespuesta" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Fecha Respuesta</mat-label>
      <input matInput [matDatepicker]="fr" formControlName="fechaRespuesta" />
      <mat-datepicker-toggle matSuffix [for]="fr"></mat-datepicker-toggle>
      <mat-datepicker #fr></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Remite (Respuesta)</mat-label>
      <input matInput formControlName="remite" />
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>A (Respuesta)</mat-label>
      <input matInput formControlName="a" />
    </mat-form-field>

    <!-- Sección 3: Estado y Archivo -->
    <mat-form-field appearance="outline">
      <mat-label>Estado</mat-label>
      <mat-select formControlName="estado">
        <mat-option *ngFor="let s of estados" [value]="s">{{ s }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- ✅ CAMPO DE ARCHIVO ACTUALIZADO: Solo botón y visualización de nombre -->
    <!-- Hemos eliminado el mat-form-field para la URL pública -->
    <div class="full-width file-input-group single-line">

      <!-- Input de archivo oculto -->
      <input
        type="file"
        style="display: none;"
        #fileInput
        (change)="onFileSelected($event)"
        accept="application/pdf,image/*"
      >

      <!-- Botón visible para seleccionar archivo -->
      <button
        mat-raised-button
        color="accent"
        (click)="fileInput.click()"
        type="button"
        class="file-select-button"
      >
        <mat-icon>folder</mat-icon> {{ selectedFileName ? 'Cambiar Archivo' : 'Seleccionar Archivo Local' }}
      </button>

      <!-- Indicador de archivo seleccionado -->
      <div *ngIf="selectedFileName" class="selected-file-name">
        <mat-icon color="primary" style="margin-right: 4px;">attach_file</mat-icon>
        <span class="file-name-text">{{ selectedFileName }}</span>
      </div>

    </div>
    <!-- ---------------------------------------------------- -->

  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="dialogRef.close()">Cancelar</button>
  <button
    mat-raised-button
    color="primary"
    (click)="save()"
    [disabled]="form.invalid"
  >
    {{ isEditMode ? 'Actualizar' : 'Guardar' }}
  </button>
</mat-dialog-actions>
